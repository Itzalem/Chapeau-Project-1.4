@model List<RunningOrderWithItemsViewModel>

@foreach (var order in Model)
{
    <div class="order-card">
        <div class="order-header">
            <div>
                <i class="fa fa-clock-o"></i> @order.OrderTime.ToString("HH:mm")<br />
                Table: #@order.TableNumber
            </div>
            <div>
                Order:#@order.OrderNumber
            </div>
            <div>

                Waiting: @order.WaitingTime.Hours:@order.WaitingTime.Minutes:@order.WaitingTime.Seconds

            </div>
        </div>

        @foreach (var group in order.runningOrderItems.GroupBy(i => i.OrderItemCategory))
        {
            var categoryStatusResult = group.First().MenuItemCategoryStatus;

            <form method="post" asp-controller="Kitchen" asp-action="UpdateCourseStatus">
                <input type="hidden" name="orderNumber" value="@order.OrderNumber" />
                <input type="hidden" name="category" value="@group.Key" />
                <div class="course-header">
                    <strong>@group.Key</strong>
                    <select name="categoryCourseStatus" onchange="this.form.submit()">
                        <option value="pending" selected="@(categoryStatusResult == ECategoryStatus.pending)">Pending</option>
                        <option value="InProcess" selected="@(categoryStatusResult == ECategoryStatus.InProcess)">In Progress</option>
                        <option value="ReadyToServe" selected="@(categoryStatusResult == ECategoryStatus.ReadyToServe)">Ready to Serve</option>
                    </select>
                </div>
            </form>
            @foreach (var item in group)
            {
                <form method="post" asp-action="UpdateItemStatus">
                    <input type="hidden" name="OrderItemId" value="@item.OrderItemId" />
                    <div class="course-item">
                        <div>
                            @item.MenuItemName <b>(@item.Quantity)</b><br />
                            @if (!string.IsNullOrWhiteSpace(item.Note))
                            {
                                <div class="item-note">--@item.Note</div>
                            }
                        </div>
                        <select name="itemStatus" onchange="this.form.submit()">
                            <option value="pending" selected="@(item.ItemStatus == EItemStatus.pending)">Pending</option>
                            <option value="BeingPrepared" selected="@(item.ItemStatus == EItemStatus.BeingPrepared)">Being Prepared</option>
                            <option value="ReadyToServe" selected="@(item.ItemStatus == EItemStatus.ReadyToServe)">Ready to Serve</option>
                        </select>
                    </div>
                </form>

            }
        }

        <footer class="order-footer">
            <form method="post" asp-action="UpdateOrderStatus">
                <input type="hidden" name="OrderNumber" value="@order.OrderNumber" />
                <div class="course-header">
                    <strong>Order Status</strong>
                    <select name="orderStatus" onchange="this.form.submit()">
                        <option value="pending" selected="@(order.Status == EOrderStatus.pending)">Pending</option>
                        <option value="inProgress" selected="@(order.Status == EOrderStatus.inProgress)">In Progress</option>
                        <option value="prepared" selected="@(order.Status == EOrderStatus.prepared)">Prepared</option>
                    </select>
                </div>
            </form>
        </footer>
    </div>
}
